---
title: "Levenshtein Distance of indexes"
output: html_notebook
---
## Introduction and background
Indexes are used to uniquely de-multiplex reads from a pool of sequenced reads. It is of utmost importance that those indexes can be distinguished. As NGS are prone to erroneous base-call, it can misidentify indexes if they look similar. Therefore the sequence of the index should be unique and be as diverse as possible. Edit distances of two string is a measurement of how many edit of a source string it takes to match it into a target string. In picking indexes sequence, one should aim for indexes combination with high enough edit distance to avoid miss-assignment 

### load library
```{r}
library(vwr)
```
### load test data
```{r}
test.index.seq <- c(
  "TAAGGCGA",
  "CGTACTAG",
  "AGGCAGAA",
  "TCCTGAGC",
  "GGACTCCT",
  "TAGGCATG",
  "CTCTCTAC",
  "CAGAGAGG",
  "GCTACGCT",
  "CGAGGCTG",
  "AAGAGGCA",
  "GTAGAGGA",
  "GCTCATGA",
  "ATCTCAGG",
  "ACTCGCTA",
  "GGAGCTAC",
  "GCGTAGTA",
  "CGGAGCCT",
  "TACGCTGC",
  "ATGCGCAG",
  "TAGCGCTC",
  "ACTGAGCG",
  "CCTAAGAC",
  "CGATCAGT",
  "TGCAGCTA",
  "TCGACGTC"
)
```

### compute a matrix of levenshtein distance of the input string

```{r}
# levenshtein.distance("AAAAAAAA",test.index.seq)
ld_mtx <- sapply(test.index.seq,levenshtein.distance,targets = test.index.seq)
# heatmap(ld_mtx, Rowv = NA, Colv = NA)
library(reshape2)
ld.df <- melt(ld_mtx)

```
### Generate heatmap
```{r}
library(ggplot2)       
library(viridis)
plot.heatmap <- ggplot(ld.df,aes(Var1,Var2))
plot.heatmap + geom_tile(aes(fill=value)) + 
  theme(axis.text.x = element_text(angle = 90),axis.title.x = element_blank(),axis.title.y = element_blank()) +
  scale_fill_viridis()
```

### generate a list of 8-mer, representing 8bp indexes. 
```{r}

lenght_index <- 8
possible_choice <- c("A","T","C","G")

### for lack of a package to generate kmer, use recursive function
printAllKLength <- function(set, k){
  n = length(set)
  printAllKLengthRec(set,"",n,k)
}
printAllKLengthRec <- function(set,prefix,n,k){
  if (k == 0){
    cat(paste0(prefix,"\n"))
    return()
  }
  for (i in seq(1,n)){
    newPrefix = paste0(prefix,set[i])
    printAllKLengthRec(set,newPrefix,n,k-1)
  }
}

capture.output(printAllKLength(possible_choice,lenght_index), file = "eight_mer.txt", append = TRUE)

```

### load the real 8mer and generate heatmap
Caution that it take a huge amount of memory using this method
```{r}
eight_mer <- read.table("~/GitHub/design_index_sequence/eight_mer.txt", quote="\"", comment.char="")
eight_mer.vector <- eight_mer$V1
ld_mtx <- sapply(eight_mer.vector,levenshtein.distance,targets = eight_mer.vector)
saveRDS(ld_mtx,file = "eight_mer_ld_mtx.rds")
ld.df <- melt(ld_mtx)

```


